<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corvid Cache</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" style="display: none;">
        <div class="text-center">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
            <div class="mt-3">Processing...</div>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/static/favicon-nav.svg" alt="" width="28" height="28" class="me-2">Corvid Cache
            </a>
            <div class="d-flex align-items-center">
                <button id="theme-toggle" class="theme-toggle me-2" title="Toggle dark/light mode">
                    <i class="bi bi-moon-fill"></i>
                </button>
                <button class="theme-toggle me-2" title="Settings & Maintenance" data-bs-toggle="modal" data-bs-target="#maintenance-modal">
                    <i class="bi bi-gear-fill"></i>
                </button>
                <span class="badge me-2" style="background-color: var(--primary-color);" title="Corvid Cache version">
                    <i class="bi bi-app"></i> v{{ app_version }}
                </span>
                <span id="ytdlp-version" class="badge bg-secondary me-2" title="yt-dlp version" style="cursor: pointer;" onclick="app.showVersionInfo()">
                    <i class="bi bi-box-seam"></i> <span id="ytdlp-version-text">...</span>
                </span>
                <span id="cookie-status" class="badge bg-secondary me-2" title="YouTube authentication" style="cursor: pointer;" data-bs-toggle="modal" data-bs-target="#cookies-modal">
                    <i class="bi bi-person-fill"></i> <span id="cookie-status-text">No Auth</span>
                </span>
                <span id="download-status" class="badge bg-secondary me-2" title="Download queue status" style="display: none;">
                    <i class="bi bi-download"></i> <span id="download-status-text">0 / 0</span>
                </span>
                <span id="ws-status" class="badge bg-danger me-2" title="WebSocket status">
                    <i class="bi bi-circle-fill"></i>
                </span>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <form id="url-form">
                <div class="mb-3">
                    <label for="url-input" class="form-label">Video/Playlist URL</label>
                    <input type="url" class="form-control" id="url-input" placeholder="https://youtube.com/watch?v=..." required>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-download me-2"></i>Download
                </button>
            </form>

            <div class="options-section">
                <h6><i class="bi bi-gear me-2"></i>Download Options</h6>

                <div class="mb-3">
                    <label for="format-select" class="form-label">Quality</label>
                    <select class="form-select" id="format-select">
                        <option value="best">Best Quality</option>
                        <option value="bestvideo[height<=1080]+bestaudio/best">1080p</option>
                        <option value="bestvideo[height<=720]+bestaudio/best">720p</option>
                        <option value="bestvideo[height<=480]+bestaudio/best">480p</option>
                        <option value="bestaudio/best">Audio Only</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="output-format-select" class="form-label">Output Format</label>
                    <select class="form-select" id="output-format-select">
                        <optgroup label="Video">
                            <option value="mp4" selected>MP4</option>
                            <option value="mkv">MKV</option>
                            <option value="webm">WebM</option>
                            <option value="avi">AVI</option>
                            <option value="mov">MOV</option>
                        </optgroup>
                        <optgroup label="Audio">
                            <option value="mp3">MP3</option>
                            <option value="m4a">M4A</option>
                            <option value="opus">Opus</option>
                            <option value="flac">FLAC</option>
                            <option value="wav">WAV</option>
                        </optgroup>
                    </select>
                </div>

                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <label for="output-template" class="form-label mb-0">Output Path</label>
                        <a href="#" class="small text-decoration-none" onclick="app.resetOutputPath(); return false;">Reset</a>
                    </div>
                    <div class="input-group mt-1">
                        <select class="form-select" id="output-preset-select" onchange="app.selectOutputPreset()">
                            <option value="">-- Select Preset --</option>
                        </select>
                        <button class="btn btn-outline-secondary" type="button" onclick="app.saveOutputPreset()" title="Save current template as preset">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                        <button class="btn btn-outline-danger d-none" type="button" id="delete-preset-btn" onclick="app.deleteOutputPreset()" title="Delete selected preset">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    <input type="text" class="form-control mt-2" id="output-template">
                    <div class="form-text">
                        Default: %(channel)s/%(upload_date)s_%(title)s.%(ext)s
                    </div>
                    <div class="form-text">
                        Variables: %(channel)s, %(title)s, %(id)s, %(ext)s, %(upload_date)s
                    </div>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="subtitles-check">
                    <label class="form-check-label" for="subtitles-check">Download Subtitles</label>
                </div>

                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="thumbnail-check">
                    <label class="form-check-label" for="thumbnail-check">Embed Thumbnail</label>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="metadata-check" checked>
                    <label class="form-check-label" for="metadata-check">Embed Metadata</label>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <ul class="nav nav-tabs mb-3" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="downloads-tab" data-bs-toggle="tab" data-bs-target="#downloads" type="button">
                        <i class="bi bi-arrow-down-circle me-1"></i>Downloads
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="files-tab" data-bs-toggle="tab" data-bs-target="#files" type="button">
                        <i class="bi bi-folder me-1"></i>Files
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="subscriptions-tab" data-bs-toggle="tab" data-bs-target="#subscriptions" type="button">
                        <i class="bi bi-rss me-1"></i>Subscriptions
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="downloads" role="tabpanel">
                    <!-- In Progress Section -->
                    <div id="in-progress-section">
                        <div class="d-flex justify-content-between align-items-center mb-3" id="downloads-actions">
                            <h6 class="mb-0 text-muted"><i class="bi bi-arrow-repeat me-1"></i>In Progress</h6>
                            <button class="btn btn-sm btn-danger" onclick="app.cancelAllActive()" title="Cancel all active downloads">
                                <i class="bi bi-stop-circle me-1"></i>Cancel All Active
                            </button>
                        </div>
                        <div id="in-progress-list">
                            <div class="empty-state empty-state-small">
                                <i class="bi bi-check-circle"></i>
                                <p>No active downloads</p>
                            </div>
                        </div>
                    </div>

                    <!-- History Section -->
                    <div id="history-section" class="mt-4">
                        <div class="d-flex justify-content-between align-items-center mb-3" id="history-actions">
                            <div class="d-flex align-items-center gap-2">
                                <h6 class="mb-0 text-muted"><i class="bi bi-clock-history me-1"></i>History</h6>
                                <select class="form-select form-select-sm" id="status-filter" style="width: auto;" onchange="app.filterByStatus()">
                                    <option value="">All</option>
                                    <option value="completed">Completed</option>
                                    <option value="failed">Failed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-success" onclick="app.clearDownloads('completed')" title="Clear completed downloads">
                                    <i class="bi bi-check-circle me-1"></i>Clear Completed
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="app.clearDownloads('cancelled')" title="Clear cancelled downloads">
                                    <i class="bi bi-x-circle me-1"></i>Clear Cancelled
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="app.clearDownloads('failed')" title="Clear failed downloads">
                                    <i class="bi bi-exclamation-circle me-1"></i>Clear Failed
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="app.clearDownloads()" title="Clear all finished downloads">
                                    <i class="bi bi-trash me-1"></i>Clear All
                                </button>
                            </div>
                        </div>
                        <div id="history-list">
                            <div class="empty-state">
                                <i class="bi bi-download"></i>
                                <p>No download history</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="files" role="tabpanel">
                    <div id="files-list">
                        <div class="empty-state">
                            <i class="bi bi-folder2-open"></i>
                            <p>No downloaded files</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="subscriptions" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Monitored Channels & Playlists</h5>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#add-subscription-modal">
                            <i class="bi bi-plus-lg me-1"></i>Add Subscription
                        </button>
                    </div>
                    <div id="subscriptions-list">
                        <div class="empty-state">
                            <i class="bi bi-rss"></i>
                            <p>No subscriptions yet</p>
                            <small class="text-muted">Add a channel or playlist to automatically download new videos</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Playlist Selection Modal -->
    <div class="modal fade" id="playlist-modal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title" id="playlist-title">Playlist</h5>
                        <small class="text-muted" id="playlist-count"></small>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="p-3 border-bottom bg-light playlist-controls-sticky">
                        <div class="d-flex gap-2 flex-wrap align-items-center">
                            <button class="btn btn-sm btn-outline-secondary" id="select-all-btn">
                                <i class="bi bi-check-all"></i> Select All
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="select-new-btn">
                                <i class="bi bi-stars" style="color: var(--primary-color);"></i> Select New Only
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="select-none-btn">
                                <i class="bi bi-x-lg"></i> Select None
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" id="deselect-members-btn" title="Deselect members-only videos">
                                <i class="bi bi-star-fill" style="color: #9333ea;"></i> Deselect Members
                            </button>
                            <span class="ms-auto badge bg-primary" id="selected-count-badge">
                                <i class="bi bi-check2-square"></i> <span id="selected-count">0</span> selected
                            </span>
                        </div>
                    </div>
                    <div id="playlist-entries"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="download-selected-btn">
                        <i class="bi bi-download me-1"></i>Download Selected
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Subscription Modal -->
    <div class="modal fade" id="add-subscription-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-rss me-2"></i>Add Subscription</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="mb-3">Subscription Settings</h6>
                            <div class="mb-3">
                                <label for="subscription-url" class="form-label">Channel or Playlist URL</label>
                                <input type="url" class="form-control" id="subscription-url" placeholder="https://youtube.com/@channel or playlist URL">
                            </div>
                            <div class="mb-3">
                                <label for="subscription-name" class="form-label">Name (optional)</label>
                                <input type="text" class="form-control" id="subscription-name" placeholder="Auto-detected from URL">
                            </div>
                            <div class="mb-3">
                                <label for="subscription-interval" class="form-label">Check Interval</label>
                                <select class="form-select" id="subscription-interval">
                                    <option value="6">Every 6 hours</option>
                                    <option value="12">Every 12 hours</option>
                                    <option value="24" selected>Once per day</option>
                                    <option value="168">Once per week</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="subscription-keep-last" class="form-label">Keep Latest Videos</label>
                                <select class="form-select" id="subscription-keep-last">
                                    <option value="0" selected>All videos</option>
                                    <option value="1">Last 1 video</option>
                                    <option value="5">Last 5 videos</option>
                                    <option value="10">Last 10 videos</option>
                                    <option value="20">Last 20 videos</option>
                                    <option value="50">Last 50 videos</option>
                                    <option value="100">Last 100 videos</option>
                                </select>
                                <small class="text-muted">Only download from the most recent videos</small>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="subscription-include-members" checked>
                                <label class="form-check-label" for="subscription-include-members">Include Members-Only Videos</label>
                            </div>
                            <div class="mb-3">
                                <label for="subscription-title-filter" class="form-label">Title Filter (optional)</label>
                                <input type="text" class="form-control" id="subscription-title-filter" placeholder="*tutorial*, *review*">
                                <small class="text-muted">Wildcard pattern to match video titles (* = any characters, ? = single character)</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="mb-3">Download Options</h6>
                            <div class="mb-3">
                                <label for="sub-format-select" class="form-label">Quality</label>
                                <select class="form-select" id="sub-format-select">
                                    <option value="best">Best Quality</option>
                                    <option value="bestvideo[height<=1080]+bestaudio/best">1080p</option>
                                    <option value="bestvideo[height<=720]+bestaudio/best">720p</option>
                                    <option value="bestvideo[height<=480]+bestaudio/best">480p</option>
                                    <option value="bestaudio/best">Audio Only</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="sub-output-format-select" class="form-label">Output Format</label>
                                <select class="form-select" id="sub-output-format-select">
                                    <optgroup label="Video">
                                        <option value="mp4" selected>MP4</option>
                                        <option value="mkv">MKV</option>
                                        <option value="webm">WebM</option>
                                    </optgroup>
                                    <optgroup label="Audio">
                                        <option value="mp3">MP3</option>
                                        <option value="m4a">M4A</option>
                                        <option value="opus">Opus</option>
                                        <option value="flac">FLAC</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="sub-output-template" class="form-label">Output Path</label>
                                <input type="text" class="form-control" id="sub-output-template" placeholder="%(channel)s/%(upload_date)s_%(title)s.%(ext)s">
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="sub-subtitles-check">
                                <label class="form-check-label" for="sub-subtitles-check">Download Subtitles</label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="sub-thumbnail-check">
                                <label class="form-check-label" for="sub-thumbnail-check">Embed Thumbnail</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sub-metadata-check" checked>
                                <label class="form-check-label" for="sub-metadata-check">Embed Metadata</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="add-subscription-btn">
                        <i class="bi bi-plus-lg me-1"></i>Add Subscription
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cookies Management Modal -->
    <div class="modal fade" id="cookies-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-shield-lock me-2"></i>YouTube Authentication</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Status Section -->
                    <div id="cookies-status-section" class="mb-4">
                        <h6>Current Status</h6>
                        <div id="cookies-status-content">
                            <div class="d-flex align-items-center">
                                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                Checking...
                            </div>
                        </div>
                    </div>

                    <!-- Upload Section -->
                    <div class="mb-4">
                        <h6>Upload Cookies</h6>
                        <div class="input-group">
                            <input type="file" class="form-control" id="cookies-file" accept=".txt">
                            <button class="btn btn-primary" type="button" id="upload-cookies-btn">
                                <i class="bi bi-upload me-1"></i>Upload
                            </button>
                        </div>
                        <div id="cookies-upload-result" class="mt-2"></div>
                    </div>

                    <!-- Instructions Section -->
                    <div class="accordion" id="cookies-instructions">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#instructions-chrome">
                                    <i class="bi bi-browser-chrome me-2"></i>Export from Chrome
                                </button>
                            </h2>
                            <div id="instructions-chrome" class="accordion-collapse collapse" data-bs-parent="#cookies-instructions">
                                <div class="accordion-body">
                                    <ol>
                                        <li>Install the <a href="https://chrome.google.com/webstore/detail/get-cookiestxt-locally/cclelndahbckbenkjhflpdbgdldlbecc" target="_blank">Get cookies.txt LOCALLY</a> extension</li>
                                        <li>Go to <a href="https://www.youtube.com" target="_blank">youtube.com</a> and make sure you're logged in</li>
                                        <li>Click the extension icon and select "Export"</li>
                                        <li>Save the file and upload it here</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#instructions-firefox">
                                    <i class="bi bi-browser-firefox me-2"></i>Export from Firefox
                                </button>
                            </h2>
                            <div id="instructions-firefox" class="accordion-collapse collapse" data-bs-parent="#cookies-instructions">
                                <div class="accordion-body">
                                    <ol>
                                        <li>Install the <a href="https://addons.mozilla.org/en-US/firefox/addon/cookies-txt/" target="_blank">cookies.txt</a> extension</li>
                                        <li>Go to <a href="https://www.youtube.com" target="_blank">youtube.com</a> and make sure you're logged in</li>
                                        <li>Click the extension icon and select "Current Site"</li>
                                        <li>Save the file and upload it here</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#instructions-edge">
                                    <i class="bi bi-browser-edge me-2"></i>Export from Edge
                                </button>
                            </h2>
                            <div id="instructions-edge" class="accordion-collapse collapse" data-bs-parent="#cookies-instructions">
                                <div class="accordion-body">
                                    <ol>
                                        <li>Install the <a href="https://microsoftedge.microsoft.com/addons/detail/get-cookiestxt-locally/helaborklaoimmjpocabalejkpfkogkb" target="_blank">Get cookies.txt LOCALLY</a> extension</li>
                                        <li>Go to <a href="https://www.youtube.com" target="_blank">youtube.com</a> and make sure you're logged in</li>
                                        <li>Click the extension icon and select "Export"</li>
                                        <li>Save the file and upload it here</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3 mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Why is this needed?</strong> YouTube authentication allows downloading age-restricted content, private videos you have access to, and helps avoid rate limiting.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" id="delete-cookies-btn">
                        <i class="bi bi-trash me-1"></i>Delete Cookies
                    </button>
                    <button type="button" class="btn btn-outline-primary" id="verify-cookies-btn">
                        <i class="bi bi-check-circle me-1"></i>Verify Cookies
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div class="modal fade" id="maintenance-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-gear me-2"></i>Settings & Maintenance</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Download Settings -->
                    <h6 class="mb-3"><i class="bi bi-sliders me-2"></i>Download Settings</h6>
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h6 class="card-title mb-1">Max Concurrent Downloads</h6>
                                    <p class="card-text small text-muted mb-0">
                                        Number of downloads that can run simultaneously. Lower values are more stable.
                                    </p>
                                </div>
                                <div class="col-auto">
                                    <select class="form-select form-select-sm" id="max-concurrent-downloads" style="width: auto;" onchange="app.saveMaxConcurrentDownloads()">
                                        <option value="1">1 (Recommended)</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Database Stats -->
                    <h6 class="mb-3"><i class="bi bi-database me-2"></i>Database Statistics</h6>
                    <div id="db-stats" class="mb-4">
                        <div class="d-flex align-items-center">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            Loading...
                        </div>
                    </div>

                    <!-- Cleanup Options -->
                    <h6 class="mb-3"><i class="bi bi-trash me-2"></i>Cleanup Options</h6>

                    <div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">Download Records</h6>
                            <p class="card-text small text-muted">Remove old completed, cancelled, or failed download records from the database.</p>
                            <div class="row g-2 align-items-end">
                                <div class="col-auto">
                                    <label class="form-label small">Older than</label>
                                    <select class="form-select form-select-sm" id="cleanup-downloads-days">
                                        <option value="7">7 days</option>
                                        <option value="14">14 days</option>
                                        <option value="30" selected>30 days</option>
                                        <option value="60">60 days</option>
                                        <option value="90">90 days</option>
                                    </select>
                                </div>
                                <div class="col-auto">
                                    <button class="btn btn-sm btn-danger" onclick="app.cleanupDownloads()">
                                        <i class="bi bi-trash me-1"></i>Clean Up
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">Download History</h6>
                            <p class="card-text small text-muted">
                                This tracks which videos have been downloaded to avoid re-downloading them when browsing playlists.
                                Clearing this will allow previously downloaded videos to be selected again.
                            </p>
                            <div class="row g-2 align-items-end">
                                <div class="col-auto">
                                    <label class="form-label small">Older than</label>
                                    <select class="form-select form-select-sm" id="cleanup-history-days">
                                        <option value="30">30 days</option>
                                        <option value="60">60 days</option>
                                        <option value="90" selected>90 days</option>
                                        <option value="180">180 days</option>
                                        <option value="365">1 year</option>
                                        <option value="">All time</option>
                                    </select>
                                </div>
                                <div class="col-auto">
                                    <button class="btn btn-sm btn-warning" onclick="app.cleanupHistory()">
                                        <i class="bi bi-clock-history me-1"></i>Clear History
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mb-3">
                        <div class="card-body">
                            <h6 class="card-title">Channel History</h6>
                            <p class="card-text small text-muted">
                                Delete download history for specific channels. This allows re-downloading videos from those channels.
                            </p>
                            <div id="channel-history-list">
                                <div class="d-flex align-items-center text-muted small">
                                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                    Loading channels...
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="cleanup-result" class="mt-3"></div>

                    <!-- Application Logs -->
                    <h6 class="mb-3 mt-4"><i class="bi bi-journal-text me-2"></i>Application Logs</h6>
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h6 class="card-title mb-1">View Logs</h6>
                                    <p class="card-text small text-muted mb-0">
                                        View application logs for debugging and troubleshooting.
                                        <span id="log-size-info" class="ms-1"></span>
                                    </p>
                                </div>
                                <div class="col-auto">
                                    <button class="btn btn-sm btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#logs-modal" onclick="app.loadLogs()">
                                        <i class="bi bi-journal-text me-1"></i>View Logs
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="app.clearLogs()">
                                        <i class="bi bi-trash me-1"></i>Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="app.loadMaintenanceStats()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Refresh Stats
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div class="modal fade" id="logs-modal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-journal-text me-2"></i>Application Logs</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-auto">
                            <select class="form-select form-select-sm" id="log-level-filter" onchange="app.loadLogs()">
                                <option value="">All Levels</option>
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO">INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                            </select>
                        </div>
                        <div class="col">
                            <input type="text" class="form-control form-control-sm" id="log-search" placeholder="Search logs..." onkeyup="app.debounceLogSearch()">
                        </div>
                        <div class="col-auto">
                            <select class="form-select form-select-sm" id="log-lines" onchange="app.loadLogs()">
                                <option value="100">Last 100 lines</option>
                                <option value="250">Last 250 lines</option>
                                <option value="500" selected>Last 500 lines</option>
                                <option value="1000">Last 1000 lines</option>
                                <option value="2500">Last 2500 lines</option>
                            </select>
                        </div>
                        <div class="col-auto">
                            <button class="btn btn-sm btn-outline-secondary" onclick="app.loadLogs()">
                                <i class="bi bi-arrow-clockwise"></i>
                            </button>
                        </div>
                    </div>
                    <div id="log-stats" class="small text-muted mb-2"></div>
                    <div id="log-content" class="log-viewer">
                        <div class="d-flex align-items-center justify-content-center p-4">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            Loading logs...
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" onclick="app.clearLogs()">
                        <i class="bi bi-trash me-1"></i>Clear Logs
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- yt-dlp Version Modal -->
    <div class="modal fade" id="version-modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-box-seam me-2"></i>yt-dlp Version</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="version-info">
                        <div class="d-flex align-items-center">
                            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                            Checking version...
                        </div>
                    </div>
                    <div id="restart-option" class="form-check mt-3" style="display: none;">
                        <input class="form-check-input" type="checkbox" id="restart-after-update">
                        <label class="form-check-label" for="restart-after-update">
                            Restart server after update
                        </label>
                        <div class="form-text"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="update-ytdlp-btn" style="display: none;">
                        <i class="bi bi-arrow-up-circle me-1"></i>Update yt-dlp
                    </button>
                    <button type="button" class="btn btn-outline-secondary" id="check-version-btn">
                        <i class="bi bi-arrow-clockwise me-1"></i>Check for Updates
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
